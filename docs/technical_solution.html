<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>508 Compliant PDF Conversion Agent Core Technical Solution</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
        }
        ul, ol {
            margin: 0 0 10px;
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        p {
            margin: 0 0 10px;
        }
    </style>
</head>
<body>
    <h1>508 Compliant PDF Conversion Agent Core Technical Solution</h1>

    <h2>Overview</h2>
    <p>The solution involves creating a command-line tool that processes PDF files to ensure they meet Section 508 accessibility compliance. The tool utilizes Python, RouteLLM for routing AI requests, and PDF generation functions to achieve this.</p>

    <h2>Components and Technologies</h2>
    <ul>
        <li><strong>PDF Content Extraction:</strong>
            <ul>
                <li><strong>Metadata Extraction:</strong> Extract metadata from the PDF, including title, author, and other document properties.</li>
                <li><strong>Content Extraction:</strong> Extract the entire content of the PDF as raw binary data, preserving all elements including text, images, and structure.</li>
                <li><strong>Tools:</strong> Use PyMuPDF and pdfminer to extract both metadata and raw binary content from the PDF.</li>
            </ul>
        </li>
        <li><strong>Content Formatting:</strong>
            <ul>
                <li><strong>Raw Binary Processing:</strong> The raw binary data is preserved and sent directly to the LLM for compliance evaluation.</li>
                <li><strong>Metadata Handling:</strong> Format the extracted metadata to include in the analysis request to the LLM.</li>
            </ul>
        </li>
        <li><strong>LLM Request Handling with RouteLLM:</strong>
            <ul>
                <li><strong>Model Selection:</strong>
                    <ul>
                        <li><strong>Strong Model (Google’s Gemini-Pro):</strong> Used for large PDF files requiring comprehensive analysis and detailed compliance checks.</li>
                        <li><strong>Weak Model (OpenAI’s GPT-4o-mini):</strong> Applied to smaller PDF files where a lighter analysis is sufficient.</li>
                    </ul>
                </li>
                <li><strong>Routing Decision:</strong> RouteLLM determines the appropriate model based on the size of the PDF file.</li>
            </ul>
        </li>
        <li><strong>Prompt Creation and Management:</strong>
            <ul>
                <li><strong>System Prompt:</strong> Instructs the LLM to review the document content thoroughly, analyze for 508 compliance, provide specific recommendations, and generate new compliant content.</li>
                <li><strong>User Prompt:</strong> Includes raw binary content and formatted metadata.</li>
                <li><strong>Prompt Content:</strong> The system prompt instructs the LLM to output a JSON object with issues found, recommendations, and the compliant content in the <code>compliant_content</code> key.</li>
            </ul>
        </li>
        <li><strong>LLM Interaction:</strong>
            <ul>
                <li>RouteLLM sends the raw binary data and formatted metadata to the selected model.</li>
                <li>The LLM analyzes the content, provides a detailed list of issues, specific content violations, recommendations, and generates compliant content.</li>
            </ul>
        </li>
        <li><strong>Generate PDF:</strong>
            <ul>
                <li><strong>Response Content:</strong> The JSON response from the LLM includes:
                    <ul>
                        <li><strong>Issues:</strong> A list of issues with details (issue, content, page number, line number, recommendation).</li>
                        <li><strong>Compliant Content:</strong> The content for generating the compliant PDF.</li>
                    </ul>
                </li>
                <li><strong>PDF Generation:</strong> Use the <code>generate_pdf</code> function with the <code>compliant_content</code> from the JSON response and the specified <code>output_path</code> to create the new compliant PDF.</li>
            </ul>
        </li>
    </ul>

    <h2>Integration Details</h2>
    <ul>
        <li><strong>RouteLLM Integration:</strong> Manage routing between Gemini-Pro and GPT-4o-mini using RouteLLM.
            <ul>
                <li>RouteLLM determines which model to use based on the file size.</li>
                <li>Configuration details and usage align with the <a href="https://github.com/lm-sys/RouteLLM?tab=readme-ov-file" target="_blank">RouteLLM documentation</a>.</li>
            </ul>
        </li>
        <li><strong>Function Definitions:</strong>
            <ul>
                <li><strong>generate_pdf Function:</strong>
                    <ul>
                        <li><strong>Parameters:</strong> <code>content</code> (string containing the compliant content), <code>output_path</code> (string specifying the file path).</li>
                        <li><strong>Purpose:</strong> Generates a PDF file at the specified path using the provided content.</li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>

    <h2>Process Flow</h2>
    <ol>
        <li><strong>Extract Content:</strong> Extract metadata and raw binary content from the PDF using PyMuPDF.</li>
        <li><strong>Format Content:</strong> Prepare extracted metadata and raw binary content for LLM processing.</li>
        <li><strong>Route Request:</strong> RouteLLM determines the PDF file size and routes the request to either the strong model (Gemini-Pro) for large files or the weak model (GPT-4o-mini) for smaller files.</li>
        <li><strong>Receive and Process Response:</strong> Analyze the response from the LLM to extract content necessary for the compliant PDF.</li>
        <li><strong>Generate PDF:</strong> Use the <code>generate_pdf</code> function to create a compliant PDF using the <code>compliant_content</code> provided by the LLM.</li>
    </ol>
</body>
</html>